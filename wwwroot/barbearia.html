<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detalhes da Barbearia - AgoraHora</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- ROOT COLORS --- */
        :root {
            --brand-navy: #0a1933;
            --brand-teal: #0da5a0;
            --brand-teal-soft: #e6f9f8;
            --brand-teal-hover: #098581;
            --brand-purple: #6366f1;
            --bg: #f8fafc;
            --card: #ffffff;
            --muted: #64748b;
            --danger: #ef4444;
            --danger-dark: #dc2626;
            --warning: #f59e0b;
            --success: #10b981;
            --info: #3b82f6;
            --border: #e2e8f0;
            --radius-lg: 20px;
            --radius-md: 14px;
            --radius-sm: 8px;
            --shadow-soft: 0 4px 15px rgba(10,25,51,.05);
            --shadow-medium: 0 10px 25px rgba(10,25,51,.08);
            --shadow-strong: 0 20px 40px rgba(10,25,51,.12);
        }
        * { box-sizing: border-box; margin:0; padding:0; }
        body { min-height:100vh; background:var(--bg); color:#334155; font:500 15px/1.5 system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; }

        /* --- HEADER --- */
        header { position:sticky; top:0; z-index:20; backdrop-filter: blur(16px); background: rgba(255,255,255,.9); border-bottom: 1px solid rgba(226,232,240,.6); box-shadow: var(--shadow-soft); }
        .top { max-width:1200px; margin:0 auto; padding:14px 20px; display:flex; align-items:center; justify-content:space-between; gap:14px; }
        .brand { display:flex; align-items:center; gap:12px; cursor:pointer; transition: transform 0.2s ease; }
        .brand:hover { transform:scale(1.02); }
        .brand-icon { width:40px; height:40px; border-radius:12px; background: linear-gradient(135deg, var(--brand-teal), var(--brand-purple)); display:flex; align-items:center; justify-content:center; box-shadow:0 4px 10px rgba(13,165,160,.25);}
        .brand-icon i { color:white; font-size:20px; }
        .brand-title { display:flex; flex-direction:column; }
        .brand-name { font-weight:800; font-size:22px; color:var(--brand-navy); }
        .brand-sub { font-size:12px; color:var(--muted); }
        .btn { border:none; border-radius: var(--radius-sm); padding:10px 18px; font-weight:600; font-size:14px; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; gap:8px; text-decoration:none; transition: all 0.2s ease; position: relative; overflow:hidden; }
        .btn::before { content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background: rgba(255,255,255,0.2); transition:left 0.3s ease; }
        .btn:hover::before { left:100%; }
        .btn-primary { background: linear-gradient(135deg, var(--brand-teal), var(--brand-teal-hover)); color:#fff; box-shadow:0 4px 15px rgba(13,165,160,.25);}
        .btn-primary:hover { transform: translateY(-2px); box-shadow:0 6px 20px rgba(13,165,160,.35); }
        .btn-ghost { background: rgba(10,25,51,.05); color:var(--brand-navy);}
        .btn-ghost:hover { background: rgba(10,25,51,.1); transform: translateY(-2px);}
        .btn-danger { background:var(--danger); color:#fff; box-shadow:0 4px 15px rgba(239,68,68,.25);}
        .btn-danger:hover { background:var(--danger-dark); transform: translateY(-2px); }

        /* --- MAIN PAGE --- */
        .page { max-width:1200px; margin:24px auto 32px; padding:0 20px 32px; }
        .hero-card { display:grid; grid-template-columns:1fr; gap:20px; background: var(--card); border-radius:var(--radius-lg); padding:20px; border:1px solid rgba(226,232,240,.6); box-shadow: var(--shadow-medium); transition:all 0.3s ease; }
        .hero-card:hover { box-shadow: var(--shadow-strong); }
        .cover-container { position:relative; overflow:hidden; border-radius:var(--radius-md);}
        .cover { width:100%; height:240px; border-radius:var(--radius-md); object-fit:cover; background:#f1f5f9; transition: transform 0.3s ease;}
        .cover-container:hover .cover { transform: scale(1.02);}
        .shop-head { display:flex; flex-wrap:wrap; align-items:flex-start; gap:16px; margin-bottom:10px;}
        .shop-title { margin:0; font-size:26px; font-weight:800; color:var(--brand-navy); display:flex; align-items:center; gap:10px;}
        .shop-title i { color:var(--brand-teal); }
        .muted { color: var(--muted); display:flex; align-items:center; gap:6px; }
        .muted i { color: var(--brand-teal); font-size:14px; }
        .badge { display:inline-flex; align-items:center; justify-content:center; padding:6px 12px; border-radius: var(--radius-sm); font-size:12px; font-weight:600; letter-spacing:.02em; text-transform:uppercase; box-shadow:0 2px 5px rgba(0,0,0,0.05);}
        .badge.open { background:#d1fae5; color:#065f46;}
        .badge.open i { color:var(--success); margin-right:4px;}
        .badge.off { background:#fee2e2; color:#991b1b;}
        .badge.off i { color:var(--danger); margin-right:4px;}
        .rating { color:#f59e0b; font-weight:700; display:flex; align-items:center; gap:4px;}
        .grid { display:grid; gap:20px; margin-top:24px;}
        .grid-2 { grid-template-columns:1fr;}
        .card { background:var(--card); border-radius:var(--radius-lg); padding:20px; border:1px solid rgba(226,232,240,.6); box-shadow: var(--shadow-soft); transition:all 0.3s ease;}
        .card:hover { box-shadow: var(--shadow-medium);}
        h3 { margin:0 0 12px; font-size:18px; color:var(--brand-navy); display:flex; align-items:center; gap:10px;}
        h3 i { color:var(--brand-teal);}
        .section-sub { font-size:13px; color:var(--muted); margin-bottom:16px; padding-left:28px; }
        label { display:block; margin:12px 0 6px; font-weight:600; color:var(--brand-navy); font-size:14px; display:flex; align-items:center; gap:6px;}
        label i { color:var(--brand-teal); font-size:12px;}
        input, select { width:100%; padding:12px 16px; border-radius:var(--radius-md); border:1px solid var(--border); background:#f8fafc; font-size:14px; outline:none; transition: all 0.2s ease;}
        input:focus, select:focus { background:#ffffff; border-color:var(--brand-teal); box-shadow:0 0 0 3px rgba(13,165,160,.15);}
        .servico-item { display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-radius:var(--radius-md); border:1px solid var(--border); margin:10px 0; background:linear-gradient(to right,#ffffff,#f8fafc); transition:all 0.2s ease;}
        .servico-item:hover { border-color:var(--brand-teal); box-shadow:0 4px 12px rgba(13,165,160,.1); transform:translateY(-2px);}
        .servico-item.selected { border-color:var(--brand-teal); background:var(--brand-teal-soft);}
        .srv-title { font-weight:700; color:var(--brand-navy); font-size:15px; display:flex; align-items:center; gap:8px;}
        .srv-title i { color:var(--brand-purple);}
        .srv-meta { color:var(--muted); font-size:13px; margin-top:4px; display:flex; align-items:center; gap:6px;}
        .srv-meta i { font-size:11px; color:var(--brand-teal);}
        .legend-row { display:flex; flex-wrap:wrap; gap:12px; align-items:center; font-size:13px; color:var(--muted); margin-top:12px; padding:12px; background:#f8fafc; border-radius:var(--radius-md);}
        .legend { display:inline-flex; align-items:center; gap:6px; font-weight:500;}
        .dot { width:10px; height:10px; border-radius:50%; }
        .dot.free { background:var(--success);}
        .dot.busy { background:var(--danger);}
        .dot.past { background:var(--muted);}
        .slots { display:grid; grid-template-columns:repeat(auto-fit,minmax(90px,1fr)); gap:10px; margin-top:16px;}
        .slot { padding:12px 8px; border-radius:var(--radius-sm); border:1px solid var(--border); text-align:center; cursor:pointer; background:#ffffff; font-weight:600; font-size:14px; transition:all 0.2s ease; position:relative; overflow:hidden;}
        .slot::before { content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background:rgba(13,165,160,0.1); transition:left 0.3s ease;}
        .slot:hover::before { left:100%;}
        .slot:hover:not(.busy):not(.past) { border-color:var(--brand-teal); transform:translateY(-2px); box-shadow:0 4px 10px rgba(13,165,160,.15);}
        .slot.selected { background: linear-gradient(135deg, var(--brand-teal), var(--brand-teal-hover)); color:#fff; border-color:var(--brand-teal); box-shadow:0 4px 15px rgba(13,165,160,.3); transform:translateY(-2px);}
        .slot.busy { background:#fee2e2; color:var(--danger); border-color:#fca5a5; cursor:not-allowed;}
        .slot.past { background:#f1f5f9; color:var(--muted); cursor:not-allowed;}
        .summary { display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-top:16px; padding:16px; background:#f8fafc; border-radius:var(--radius-md);}
        .pill { border-radius:var(--radius-sm); padding:8px 14px; background:var(--brand-teal-soft); color:var(--brand-navy); font-size:13px; font-weight:600; white-space:nowrap; display:flex; align-items:center; gap:6px; box-shadow:0 2px 5px rgba(0,0,0,0.05);}
        .pill i { color:var(--brand-teal);}
        .actions-row { margin-top:16px; display:flex; flex-wrap:wrap; gap:12px; justify-content:flex-end;}
        .error { margin-top:12px; color:var(--danger); font-weight:600; font-size:13px; display:none; padding:10px 14px; background:#fee2e2; border-left:4px solid var(--danger);}
        .modal-backdrop { position:fixed; inset:0; background:rgba(10,25,51,.5); display:none; align-items:center; justify-content:center; padding:20px; z-index:50;}
        .modal { width:min(520px,100%); background:#ffffff; border-radius:var(--radius-lg); padding:24px; box-shadow:var(--shadow-strong); animation: modalFadeIn 0.3s ease; }
        @keyframes modalFadeIn { from{opacity:0;transform:translateY(-20px);} to{opacity:1; transform:translateY(0);} }
        .modal h3 { margin:0 0 12px; font-size:20px; color:var(--brand-navy); display:flex; align-items:center; gap:10px;}
        .modal h3 i { color:var(--brand-teal);}
        .modal-actions { display:flex; flex-wrap:wrap; gap:12px; justify-content:flex-end; margin-top:20px;}
        .ok { background:var(--brand-teal-soft); border-radius:var(--radius-md); border:1px solid var(--brand-teal); padding:12px 16px; margin-top:12px; font-size:14px; color:var(--brand-navy); display:flex; align-items:center; gap:8px;}
        .ok i { color:var(--success);}
        @media(min-width:900px) { .hero-card { grid-template-columns:320px 1fr; } .cover { height:100%; } .grid-2 { grid-template-columns:2fr 3fr; } }
        @media(max-width:520px) { .top { padding-inline:14px; } .page { padding-inline:14px; } .hero-card, .card { padding-inline:16px; } .summary { flex-direction:column; align-items:flex-start;} .pill { width:100%;} }
    </style>
</head>
<body>
    <!-- --- HEADER --- -->
    <header>
        <div class="top">
            <div class="brand" aria-label="AgoraHora">
                <div class="brand-icon"><i class="fas fa-cut"></i></div>
                <div class="brand-title">
                    <span class="brand-name">AgoraHora</span>
                    <span class="brand-sub">Sua agenda premium de barbearia</span>
                </div>
            </div>
            <a class="btn btn-ghost" href="home-cliente.html"><i class="fas fa-arrow-left"></i> Voltar</a>
        </div>
    </header>

    <!-- --- MAIN --- -->
    <main class="page">
        <!-- Hero Card -->
        <section class="hero-card">
            <div class="cover-container">
                <img id="cover" class="cover" alt="Logo/Foto da barbearia" referrerpolicy="no-referrer" crossorigin="anonymous">
            </div>
            <div>
                <div class="shop-head">
                    <div>
                        <h2 id="shop-name" class="shop-title"><i class="fas fa-store"></i> Barbearia</h2>
                        <div id="shop-address" class="muted"><i class="fas fa-map-marker-alt"></i> Endereço</div>
                        <div class="muted"><i class="fas fa-star"></i> Avaliação: <span id="shop-rating" class="rating">—</span></div>
                    </div>
                    <div style="margin-left:auto"><span id="shop-open" class="badge">—</span></div>
                </div>
                <p class="muted" style="margin-top:12px">Escolha um serviço, o profissional, selecione a data e confirme seu horário em poucos cliques.</p>
            </div>
        </section>

        <!-- Grid 2 Cols -->
        <section class="grid grid-2">
            <!-- Serviços -->
            <div class="card">
                <h3><i class="fas fa-concierge-bell"></i> Serviços</h3>
                <p class="section-sub">Toque em um serviço para ver os horários disponíveis.</p>
                <div id="lista-servicos"></div>
            </div>

            <!-- Agendar -->
            <div class="card">
                <h3><i class="fas fa-calendar-check"></i> Agendar</h3>
                <p class="section-sub">Preencha os campos abaixo e selecione um horário disponível.</p>
                <label for="prof"><i class="fas fa-user-tie"></i> Profissional</label>
                <select id="prof"></select>
                <label for="data"><i class="fas fa-calendar"></i> Data</label>
                <input type="date" id="data" />
                <div class="legend-row">
                    <span class="legend"><span class="dot free"></span>Disponível</span>
                    <span class="legend"><span class="dot busy"></span>Ocupado</span>
                    <span class="legend"><span class="dot past"></span>Passado</span>
                </div>
                <div id="slots" class="slots"></div>
                <div class="summary" id="resumo"></div>
                <div class="error" id="erro-slot">Selecione um horário válido.</div>
                <div class="actions-row">
                    <button id="confirmar" class="btn btn-primary">Confirmar Agendamento</button>
                </div>
            </div>
        </section>
    </main>

    <!-- --- MODAL CLIENTE --- -->
    <div class="modal-backdrop" id="modal-cliente">
        <div class="modal">
            <h3><i class="fas fa-id-badge"></i> Identificar Cliente</h3>
            <label>Nome</label><input type="text" id="cliente-nome">
            <label>Telefone</label><input type="text" id="cliente-tel">
            <div class="modal-actions">
                <button id="cliente-ok" class="btn btn-primary">Confirmar</button>
                <button id="cliente-cancel" class="btn btn-ghost">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- --- MODAL SUCESSO --- -->
    <div class="modal-backdrop" id="modal-sucesso">
        <div class="modal">
            <h3><i class="fas fa-check-circle"></i> Agendamento Confirmado</h3>
            <p>Seu horário foi agendado com sucesso!</p>
            <div class="modal-actions">
                <button class="ok" id="ok-sucesso">OK</button>
            </div>
        </div>
    </div>

    <!-- --- JS --- -->
    <script>
        const API_BASE = 'http://179.0.176.111:5000/api';
        const $ = document.querySelector.bind(document);
        const $$ = document.querySelectorAll.bind(document);

        let estabelecimentoId = 1; // ID fictício, ajustar conforme sua rota
        let servicos = [], profs = [], slotsData = [], slotSelecionado = null, servicoSelecionado = null;

        // --- UTILIDADES ---
        const toHM = (minutes) => {
            const h = Math.floor(minutes / 60);
            const m = minutes % 60;
            return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
        };

        const atualizarResumo = (hora) => {
            const resumoEl = $("#resumo");
            resumoEl.innerHTML = "";
            if(!servicoSelecionado || !hora) return;
            const pill = document.createElement("div");
            pill.className = "pill";
            pill.innerHTML = `<i class="fas fa-cut"></i>${servicoSelecionado.NM_SERVICO} às ${hora}`;
            resumoEl.appendChild(pill);
        };

        const fecharModal = (id) => $(id).style.display = "none";
        const abrirModal = (id) => $(id).style.display = "flex";

        // --- LOAD CONFIG ---
        async function loadConfig() {
            try {
                const r = await fetch(`${API_BASE}/configuracao/${estabelecimentoId}`);
                const config = await r.json();
                $("#cover").src = config.IMAGEM || "";
                $("#shop-name").textContent = config.NM_ESTABELECIMENTO || "Barbearia";
                $("#shop-address").textContent = config.DS_ENDERECO || "Endereço";
                $("#shop-rating").textContent = config.RATING || "—";
                $("#shop-open").textContent = config.OPEN ? "Aberto" : "Fechado";
                $("#shop-open").className = "badge " + (config.OPEN ? "open" : "off");
            } catch(e) { console.error("Erro ao carregar configuração", e); }
        }

        // --- LOAD SERVICOS & PROF ---
        async function loadServicos() {
            try {
                const r = await fetch(`${API_BASE}/servicos/${estabelecimentoId}`);
                servicos = await r.json();
                const lista = $("#lista-servicos");
                lista.innerHTML = "";
                servicos.forEach(s => {
                    const div = document.createElement("div");
                    div.className = "servico-item";
                    div.innerHTML = `<div class="srv-title"><i class="fas fa-cut"></i>${s.NM_SERVICO}</div><div class="srv-meta">${s.DS_DURACAO} min</div>`;
                    div.onclick = () => {
                        servicos.forEach(x => x.selected=false);
                        servicoSelecionado = s;
                        s.selected = true;
                        $$(".servico-item").forEach(el => el.classList.remove("selected"));
                        div.classList.add("selected");
                        gerarSlots();
                        atualizarResumo(slotSelecionado);
                    };
                    lista.appendChild(div);
                });
            } catch(e){ console.error(e); }
        }

        async function loadProfs() {
            try {
                const r = await fetch(`${API_BASE}/profissionais/${estabelecimentoId}`);
                profs = await r.json();
                const sel = $("#prof");
                sel.innerHTML = '<option value="">Selecione</option>';
                profs.forEach(p => sel.innerHTML += `<option value="${p.ID_PROFISSIONAL}">${p.NM_PROFISSIONAL}</option>`);
            } catch(e){ console.error(e); }
        }

        // --- SLOTS ---
        function gerarSlots() {
            if(!servicoSelecionado) return;
            const slotsEl = $("#slots");
            slotsEl.innerHTML = "";
            // gerar exemplo de slots
            const now = new Date();
            for(let h=9; h<18; h++) {
                const slotDiv = document.createElement("div");
                slotDiv.className = "slot";
                const hora = `${h.toString().padStart(2,'0')}:00`;
                const slotDate = new Date();
                slotDate.setHours(h,0,0,0);
                if(slotDate<now) slotDiv.classList.add("past");
                slotDiv.textContent = hora;
                slotDiv.onclick = () => {
                    if(slotDiv.classList.contains("past")) return;
                    $$(".slot.selected").forEach(s => s.classList.remove("selected"));
                    slotDiv.classList.add("selected");
                    slotSelecionado = hora;
                    atualizarResumo(hora);
                    $("#erro-slot").style.display = "none";
                };
                slotsEl.appendChild(slotDiv);
            }
        }

        // --- CONFIRMAR AGENDAMENTO ---
        $("#confirmar").onclick = () => {
            if(!slotSelecionado) { $("#erro-slot").style.display = "block"; return; }
            abrirModal("#modal-cliente");
        };

        $("#cliente-ok").onclick = async () => {
            const nome = $("#cliente-nome").value.trim();
            const tel = $("#cliente-tel").value.trim();
            if(!nome || !tel) return alert("Preencha todos os campos.");
            // exemplo POST
            try {
                await fetch(`${API_BASE}/agendamentos`, {
                    method:"POST",
                    headers:{"Content-Type":"application/json"},
                    body: JSON.stringify({
                        ID_ESTABELECIMENTO: estabelecimentoId,
                        ID_SERVICO: servicoSelecionado.ID_SERVICO,
                        ID_PROFISSIONAL: $("#prof").value,
                        DT_AGENDAMENTO: $("#data").value,
                        HR_INICIO: slotSelecionado,
                        NM_CLIENTE: nome,
                        NM_TELEFONE: tel
                    })
                });
                fecharModal("#modal-cliente");
                abrirModal("#modal-sucesso");
            } catch(e){ console.error(e); alert("Erro ao agendar."); }
        };

        $("#cliente-cancel").onclick = () => fecharModal("#modal-cliente");
        $("#ok-sucesso").onclick = () => fecharModal("#modal-sucesso");

        $("#data").onchange = gerarSlots;

        // --- INIT ---
        loadConfig();
        loadServicos();
        loadProfs();
    </script>
</body>
</html>
