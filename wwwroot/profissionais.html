<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Profissionais - AgoraHora</title>
<style>
  :root{--brand-navy:#0f2b5c;--brand-teal:#19b7a6;--brand-teal-hover:#139987;--bg:#f5f7fa;--card:#fff;--muted:#8a94a6}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#1c2430;font:500 15px/1.45 Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  header{background:#fff;border-bottom:1px solid #e9eef5;position:sticky;top:0;z-index:10}
  .top{max-width:1200px;margin:auto;padding:14px 20px;display:flex;align-items:center;gap:14px;justify-content:space-between}
  .brand{display:flex;align-items:center;gap:10px}.brand svg{width:34px;height:34px}.brand .name{font-weight:800;font-size:20px;color:var(--brand-navy)}
  .btn{padding:10px 14px;border:none;border-radius:10px;background:var(--brand-teal);color:#fff;font-weight:700;cursor:pointer}
  .btn:hover{background:var(--brand-teal-hover)}
  .container{max-width:1200px;margin:24px auto;padding:0 20px}
  .grid{display:grid;gap:16px}@media(min-width:900px){.grid-2{grid-template-columns:1fr 2fr}}
  .card{background:var(--card);border-radius:20px;padding:20px;box-shadow:0 16px 40px rgba(15,43,92,.06),0 4px 12px rgba(15,43,92,.05)}
  label{display:block;margin:8px 0 6px;color:var(--brand-navy);font-weight:700}
  input{width:100%;padding:10px 12px;border:1px solid #e3e8ef;border-radius:10px;outline:none}
  input:focus{box-shadow:0 0 0 4px rgba(25,183,166,.12)}
  table{width:100%;border-collapse:collapse} th,td{padding:12px 10px;border-bottom:1px solid #eef2f7;text-align:left} th{color:#30405a;font-size:13px}
  .empty{color:var(--muted);padding:6px 0}
</style>
</head>
<body>
<header>
  <div class="top">
    <div class="brand" aria-label="AgoraHora">
      <svg viewBox="0 0 64 64" aria-hidden="true"><circle cx="32" cy="32" r="28" fill="none" stroke="#19b7a6" stroke-width="6"/><path d="M20 33.5l7 7 17-17" fill="none" stroke="#19b7a6" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <div class="name">AgoraHora</div>
    </div>
    <button class="btn" id="logout">Voltar</button>
  </div>
</header>

<main class="container grid grid-2">
  <div class="card">
    <h2 style="margin-top:0;color:var(--brand-navy)">Cadastrar profissional</h2>
    <label for="nome">Nome</label>
    <input id="nome" placeholder="Ex.: João Silva">
    <label for="especialidade">Especialidade</label>
    <input id="especialidade" placeholder="Ex.: Barba, Corte, Infantil">
    <button class="btn" id="btn-salvar" style="margin-top:10px">Salvar</button>
    <div id="msg" class="empty" style="display:none;margin-top:8px">Salvo!</div>
  </div>

  <div class="card">
    <h2 style="margin-top:0;color:var(--brand-navy)">Profissionais</h2>
    <table>
      <thead><tr><th>Nome</th><th>Especialidade</th></tr></thead>
      <tbody id="tbody"><tr><td class="empty" colspan="2">Sem profissionais…</td></tr></tbody>
    </table>
  </div>
</main>

<script>
  const tbody = document.getElementById('tbody');
  const msg   = document.getElementById('msg');
  document.getElementById('logout').onclick = () => location.href = 'index.html';

  // ID do estabelecimento salvo após login
  const estabId = Number(localStorage.getItem('ah_estabelecimentoId') || 1);

  async function api(path, opts = {}) {
    const headers = { 'Content-Type': 'application/json' };
    const token = localStorage.getItem('ah_token');
    if (token) headers['Authorization'] = 'Bearer ' + token;

    const res = await fetch('/api' + path, {
      method: opts.method || 'GET',
      headers,
      body: opts.body ? JSON.stringify(opts.body) : undefined
    });
    if (!res.ok) throw new Error(await res.text());
    const ct = res.headers.get('content-type') || '';
    return ct.includes('application/json') ? res.json() : res.text();
  }

  function render(lista){
    if (!lista.length){
      tbody.innerHTML = `<tr><td class="empty" colspan="2">Sem profissionais…</td></tr>`;
      return;
    }
    tbody.innerHTML = lista.map(p =>
      `<tr><td>${p.nome ?? p.Nome}</td><td>${p.especialidade ?? p.Especialidade ?? '—'}</td></tr>`
    ).join("");
  }

  async function carregar(){
    const r = await api(`/profissionais/${estabId}?page=1&pageSize=50`);
    const dados = Array.isArray(r) ? r : (r.data ?? []);
    render(dados);
  }

  document.getElementById('btn-salvar').onclick = async () => {
    const nome = document.getElementById('nome').value.trim();
    const especialidade = document.getElementById('especialidade').value.trim();
    if (!nome){ alert('Informe o nome.'); return; }

    await api('/profissionais', {
      method: 'POST',
      body: { EstabelecimentoId: estabId, Nome: nome, Especialidade: especialidade }
    });

    document.getElementById('nome').value = '';
    document.getElementById('especialidade').value = '';
    msg.style.display = 'block';
    setTimeout(()=> msg.style.display='none',1500);
    await carregar();
  };

  carregar();
</script>
</body>
</html>
